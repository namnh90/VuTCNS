<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PAD Custom Form</title>
  <style>
    :root {
      --bg: #0b1020;
      --card: #121a33;
      --muted: #a9b3c7;
      --text: #eef2ff;
      --accent: #6aa1ff;
      --accent-2: #9bffd1;
      --danger: #ff7a7a;
      --radius: 16px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text); background: radial-gradient(1200px 800px at 80% -10%, #1a2450 0%, var(--bg) 38%),
               radial-gradient(900px 600px at -10% 110%, #10333a 0%, var(--bg) 40%), var(--bg);
      display: grid; place-items: center; padding: 24px;
    }
    .card {
      width: 100%; max-width: 980px; background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.08); border-radius: var(--radius); box-shadow: var(--shadow);
      backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); padding: 28px; position: relative;
    }
    .title {
      font-size: 24px; font-weight: 800; letter-spacing: 0.2px; margin: 0 0 6px; display: flex; align-items: center; gap: 10px;
    }
    .subtitle { color: var(--muted); margin: 0 0 24px; }
    .grid {
      display: grid; grid-template-columns: 1fr; gap: 16px; align-items: start;
    }
    @media (min-width: 820px) {
      .grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    .field { display: grid; gap: 8px; }
    label { font-weight: 600; color: #dbe6ff; font-size: 14px; }
    input, select, textarea {
      background: #0f1530; border: 1px solid rgba(255,255,255,0.08); color: var(--text);
      padding: 12px 14px; border-radius: 12px; outline: none; font-size: 14px; transition: border-color .2s, box-shadow .2s;
    }
    input:focus, select:focus, textarea:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(106,161,255,.25); }
    textarea { min-height: 110px; resize: vertical; }
    .row-span-2 { grid-row: span 2; }
    .actions { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 18px; }
    button {
      padding: 12px 16px; border: 0; border-radius: 12px; font-weight: 700; cursor: pointer; letter-spacing: .2px;
      transition: transform .03s ease, box-shadow .2s ease, background .2s ease;
    }
    .btn-primary { background: linear-gradient(90deg, var(--accent), #7fb1ff); color: #0a0f22; box-shadow: 0 8px 18px rgba(106,161,255,.35); }
    .btn-secondary { background: linear-gradient(90deg, var(--accent-2), #b6ffe3); color: #05241a; box-shadow: 0 8px 18px rgba(155,255,209,.25); }
    .btn-danger { background: linear-gradient(90deg, #ff8b8b, var(--danger)); color: #2a0a0a; box-shadow: 0 8px 18px rgba(255,122,122,.25); }
    button:active { transform: translateY(1px); }
    .status { margin-left: auto; color: var(--muted); font-size: 13px; align-self: center; }
    .json-wrap { margin-top: 14px; }
    .hint { color: var(--muted); font-size: 12px; margin-top: 4px; }
    .pill { display: inline-flex; align-items: center; gap: 8px; font-size: 12px; color: var(--muted); background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.08); padding: 6px 10px; border-radius: 999px; }
    .badge { display:inline-block; background: rgba(106,161,255,.18); color: #cfe0ff; padding: 2px 8px; border-radius: 999px; font-weight: 700; font-size: 11px; border: 1px solid rgba(106,161,255,.35) }
    .hr { height: 1px; background: linear-gradient(90deg, rgba(255,255,255,.1), rgba(255,255,255,0)); margin: 20px 0; }
  </style>
</head>
<body>
  <div class="card" role="region" aria-labelledby="title">
    <div class="pill" style="position:absolute; right:16px; top:14px;">HTML Form • <span class="badge">2 CỘT</span></div>

    <h1 id="title" class="title">Phiếu nhập liệu</h1>
    <p class="subtitle">Form 2 cột cho Power Automate Desktop. Nhấn <b>Tạo JSON</b> để sinh payload cho PAD đọc.</p>

    <form id="dataForm" class="grid" novalidate>
      <div class="field">
        <label for="fullName">Họ và tên *</label>
        <input id="fullName" name="fullName" placeholder="VD: Nguyễn Văn A" required />
        <small class="hint">Bắt buộc</small>
      </div>

      <div class="field">
        <label for="email">Email *</label>
        <input id="email" name="email" type="email" placeholder="ten@congty.com" required />
        <small class="hint">Dùng định dạng email hợp lệ</small>
      </div>

      <div class="field">
        <label for="department">Phòng ban</label>
        <select id="department" name="department">
          <option value="">— Chọn —</option>
          <option>Nhân sự</option>
          <option>Kế toán</option>
          <option>IT</option>
          <option>Kinh doanh</option>
          <option>Vận hành</option>
        </select>
      </div>

      <div class="field">
        <label for="phone">Số điện thoại</label>
        <input id="phone" name="phone" placeholder="09xx xxx xxx" />
      </div>

      <div class="field">
        <label for="startDate">Ngày bắt đầu *</label>
        <input id="startDate" name="startDate" type="date" required />
        <small class="hint">Bắt buộc</small>
      </div>

      <div class="field row-span-2">
        <label for="notes">Ghi chú</label>
        <textarea id="notes" name="notes" placeholder="Nội dung ghi chú..."></textarea>
      </div>
    </form>

    <div class="actions">
      <button class="btn-primary" id="btnGenerate" type="button">Tạo JSON</button>
      <button class="btn-secondary" id="btnCopy" type="button">Copy JSON</button>
      <button class="btn-danger" id="btnReset" type="button">Xóa trắng</button>
      <div class="status" id="status">Chưa tạo payload.</div>
    </div>

    <div class="json-wrap">
      <label for="jsonOutput" style="display:block;margin-bottom:6px;color:#c8d6ff;font-weight:700;">JSON payload</label>
      <textarea id="jsonOutput" readonly placeholder="Nhấn Tạo JSON để sinh dữ liệu..." style="width:100%;min-height:120px"></textarea>
      <div class="hint">PAD có thể đọc giá trị của ô này (element #jsonOutput), URL hash, hoặc tiêu đề trang để lấy JSON.</div>
    </div>

    <div class="hr"></div>
    <div class="hint">Gợi ý dùng với PAD: sau khi bấm <b>Tạo JSON</b>, dùng action <i>Web automation ➜ Get details of web page</i> để lấy <b>Page URL</b> (có <code>#data=...</code>) hoặc <b>Page title</b>; hoặc dùng <i>Get details of element</i> cho <code>#jsonOutput</code>.</div>
  </div>

  <script>
    const $ = (sel) => document.querySelector(sel);

    function toISODate(value) {
      // value from input[type=date] is already yyyy-mm-dd; convert to ISO start-of-day
      if (!value) return null;
      const d = new Date(value + 'T00:00:00');
      const pad = n => String(n).padStart(2,'0');
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    }

    function buildPayload() {
      const data = {
        fullName: $('#fullName').value.trim(),
        email: $('#email').value.trim(),
        department: $('#department').value.trim(),
        phone: $('#phone').value.trim(),
        startDate: toISODate($('#startDate').value),
        notes: $('#notes').value.trim(),
        _meta: {
          source: 'pad-html-form',
          generatedAt: new Date().toISOString(),
          version: 1
        }
      };
      return data;
    }

    function validate() {
      const form = $('#dataForm');
      // simple custom UI validation messages
      let ok = true;
      form.querySelectorAll('[required]').forEach(el => {
        el.style.borderColor = '';
        if (!el.value) { el.style.borderColor = '#ff7a7a'; ok = false; }
      });
      const email = $('#email').value.trim();
      if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { $('#email').style.borderColor = '#ff7a7a'; ok = false; }
      return ok;
    }

    function setStatus(text) { $('#status').textContent = text; }

    async function copyToClipboard(text) {
      try {
        await navigator.clipboard.writeText(text);
        setStatus('Đã copy vào clipboard.');
      } catch (e) {
        // Fallback: select textarea for manual copy (PAD có thể gửi Ctrl+A Ctrl+C)
        const ta = $('#jsonOutput');
        ta.removeAttribute('readonly');
        ta.focus();
        ta.select();
        document.execCommand('copy');
        ta.setAttribute('readonly', '');
        setStatus('Đã copy (fallback).');
      }
    }

    function updatePageIdentifiers(json) {
      // Put data into URL hash so PAD có thể đọc Page URL
      const enc = encodeURIComponent(json);
      const newUrl = `${location.origin}${location.pathname}#data=${enc}`;
      history.replaceState(null, '', newUrl);
      // Also put into title (ngắn gọn) để PAD có thể đọc Page Title
      const short = json.length > 300 ? json.slice(0, 300) + '…' : json;
      document.title = 'PAD • ' + short;
    }

    $('#btnGenerate').addEventListener('click', () => {
      if (!validate()) { setStatus('Thiếu thông tin bắt buộc hoặc email không hợp lệ.'); return; }
      const payload = buildPayload();
      const json = JSON.stringify(payload);
      $('#jsonOutput').value = json;
      updatePageIdentifiers(json);
      setStatus('Đã tạo payload JSON.');
    });

    $('#btnCopy').addEventListener('click', async () => {
      const json = $('#jsonOutput').value || JSON.stringify(buildPayload());
      if (!json) { setStatus('Chưa có nội dung để copy.'); return; }
      await copyToClipboard(json);
    });

    $('#btnReset').addEventListener('click', () => {
      document.getElementById('dataForm').reset();
      $('#jsonOutput').value = '';
      history.replaceState(null, '', location.pathname);
      document.title = 'PAD Custom Form';
      setStatus('Đã xóa trắng.');
    });
  </script>
</body>
</html>